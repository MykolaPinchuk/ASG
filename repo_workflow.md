# Repo workflow

This file contains **repo-specific** agent workflow rules (triggers + procedures).

General multi-repo instructions are provided in `agents.md` (generated by `context-manager-1`).

## Repo-wide constraints
- This repo is developed primarily by sequential Codex agents (agent00, agent01, ...).
- Use Pacific time for timestamps in logs.
- Branches are version-aligned: `v0`, then `v1`, `v2`, ... (human pushes).
- Make changes only on the current `vN` branch unless the human explicitly asks otherwise.
- Never commit secrets or bulky artifacts (see `.gitignore`).
- Operational guardrails (v0 / v0.x):
  - Always save replays for any eval run (so results are inspectable).
  - Replay turns must always include `latencyMs` (this is required for model/perf analysis; do not regress it).
  - Default eval horizon is short: `turnCapPlies <= 30` and `games/count <= 5` per matchup/model unless explicitly overridden.
  - Avoid `RandomBot` unless explicitly requested (it’s too weak for most evals).

See also: `extra_instructions_v0.md` (human-authored guardrails; keep in sync with CLI defaults).

## Commit message format (agents)
All agent-made commits MUST include the agent id prefix:
- `agentNN: checkpoint(<area>): <summary>` for incremental progress commits (default)
- `agentNN: handoff(<area>): <summary>` for end-of-cycle handoff commits

Where:
- `agentNN` is read from `agent_logs/current.md` (`id: agentNN`)
- `<area>` is one of: `workflow`, `docs`, `engine`, `runner`, `viewer`, `schemas`, `misc`

If you create a commit outside the `checkpoint`/`handoff` skills, still follow the same format.

## Triggers
- User message **exactly**: `Onboard`
  - Perform the onboarding procedure below.
- User message **exactly**: `checkpoint`
  - Perform a safe checkpoint commit (use `.codex/skills/checkpoint/SKILL.md` as the procedure).
- User message contains: `wrap up` or `handoff` (any case)
  - Perform the wrap-up + handoff procedure (use `.codex/skills/handoff/SKILL.md`).

Note: agents may also create additional safe checkpoint commits after coherent milestones, following the same safety rules as the `checkpoint` skill.

## Onboard procedure (trigger: `Onboard`)
**Goal:** quickly understand current repo state without indiscriminate scanning.

1) Read (in order, if present):
   - `onboarding.md`
   - `HANDOFF.md`
   - `REPO_MAP.md`
   - `README.md` (focus on "For agents" + quickstart sections)
   - `docs/planning/MVP_SPEC.md` (normative spec)

2) Bounded discovery:
   - Propose up to **10** additional files you need for the *current* slice.
   - Open only those files after listing them with a 1-line reason each.
   - Do **not** scan the repo broadly during onboarding.

3) Output contract:
   - 5-bullet summary of current state
   - 3 next-slice options (each 1–2 bullets)
   - list of files read
   - unknowns / risks (<= 5 bullets)

4) Logging:
   - Append a short entry to `agent_logs/current.md` capturing understanding and intended next steps.

## Logging (during work)
Maintain a reasonably detailed log in `agent_logs/current.md`.
Write an entry:
- after onboarding
- after each meaningful milestone (decision, change, run result)
- after any failure worth remembering
- after important new information was discovered/learnt
- in general log anything which future agents may potentially find useful
