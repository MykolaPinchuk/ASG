# ASG

ASG is a small, deterministic, replayable turn-based strategy game designed as an evaluation environment for LLM agents.

## For agents
Start here (in order):
- `agents.md` (generated by `context-manager-1`; general instructions)
- `repo_workflow.md` (repo-specific workflow: triggers + procedures)
- `onboarding.md` (how onboarding works here)
- `HANDOFF.md` (current state / next steps)
- `REPO_MAP.md` (index of important files)
- `agent_logs/current.md` (live execution log; history indexed in `agent_logs/INDEX.md`)

## Key docs (MVP v0)
- `docs/planning/MVP_SPEC.md` — normative rules/spec (source of truth)
- `docs/planning/IMPLEMENTATION_PLAN.md` — milestones and deliverables
- `docs/planning/ROADMAP.md` — post-MVP direction
- `scenarios/scenario_01.json` — Scenario 01 data
- `schemas/replay.schema.json` — replay validation schema
- `schemas/agent_api.schema.json` — agent HTTP wire schema (future)

## Quickstart (run + watch)
- Install deps: `npm install`
- Run a match (writes JSON under `replays/`): `npm run match -- --seed 1 --p1 greedy --p2 random`
- Validate replay: `npm run validate:replay -- replays/<file>.json`
- Check determinism (same seed/actions ⇒ same replay, ignoring `createdAt`): `npm run check:determinism -- --seed 1 --p1 greedy --p2 random`
- Batch run (quick win/draw rate glance): `npm run batch -- --start 1 --count 20 --p1 greedy --p2 greedy`
- Batch report (more metrics): `npm run report -- --start 1 --count 50 --p1 greedy --p2 greedy --format text`
- Open the viewer: `viewer/index.html` and load the replay file via file picker (or drag/drop).

## Agent integration (HTTP)
The match runner can call an external agent over HTTP (`POST /act`) per `docs/planning/AGENT_API_SPEC.md`.

- Start a local stub agent server (no API keys needed): `npm run agent:stub`
- Start the full agent server (supports `stub` + `openai_compat`): `npm run agent:server -- --provider stub`
- Run a match vs the agent:
  - `npm run match -- --seed 1 --p1 greedy --p2 agent --agent-url http://127.0.0.1:8787`
  - Optional: log raw request/response per ply under `runs/`: add `--agent-log-dir runs/agent_io`

### Real LLM (OpenAI-compatible providers)
Run the agent server with `openai_compat` and point it at an OpenAI-compatible endpoint (e.g. OpenRouter).
Keys stay local (env vars / `secrets/`), never committed.

Example (OpenRouter):
- `export ASG_OPENAI_API_KEY='...'`
- `npm run agent:server -- --provider openai_compat --base-url https://openrouter.ai/api/v1 --model openai/gpt-4o-mini`

## Agent triggers
- `Onboard` — deterministic onboarding
- `checkpoint` — safe checkpoint commit
- `handoff` / `wrap up` — update handoff docs, rotate logs, and create a safe handoff commit

## Context manager integration
To generate `agents.md` and `business_context.md`:
- `python /path/to/context-manager-1/sync_context.py --repo /path/to/ASG`
